<!DOCTYPE html>
<html>
<head>
	<title>Exploitants en activités particulières au moyen d'aéronefs télé-pilotés</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!--CSS Leaflet-->
	<link rel="stylesheet" type="text/css" href="./lib/leaflet/leaflet.css" />
	<!--CSS Leaflet-MiniMap : https://github.com/Norkart/Leaflet-MiniMap-->
	<link rel="stylesheet" type="text/css" href="./lib/leaflet-plugin/MiniMap/Control.MiniMap.css" />
	<!--CSS Leaflet.MousePosition : https://github.com/ardhi/Leaflet.MousePosition-->
	<link rel="stylesheet" type="text/css" href="./lib/leaflet-plugin/MousePosition/L.Control.MousePosition.css" />
	<!--CSS Leaflet.GeoSearch : https://github.com/smeijer/L.GeoSearch-->
	<link rel="stylesheet" type="text/css" href="./lib/leaflet-plugin/GeoSearch/css/l.geosearch.css" />
	<!--CSS Leaflet.MarkerCluster : https://github.com/Leaflet/Leaflet.markercluster -->
	<link rel="stylesheet" type="text/css" href="./lib/leaflet-plugin/MarkerCluster/MarkerCluster.css" />
	<link rel="stylesheet" type="text/css" href="./lib/leaflet-plugin/MarkerCluster/MarkerCluster.Default.css" />


  <style>
      body {
          padding: 0;
          margin: 0;
					background-color :#435a6b;
      }
			html, body, #map {
					height: 100%;
					font: 10pt "Helvetica Neue", Arial, Helvetica, sans-serif;
			}
  </style>
</head>


<body>
	<!--Clé API GoogleMaps/--/http://cartographie.iaat.org-->
<!--
    <script src="https://maps.googleapis.com/maps/api/js?v=3"></script>
-->
    
	<!--JS jquery -->
	<script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>

	<!--JS Leaflet-->
	<script src="./lib/leaflet/leaflet.js"></script>
	<!--JS Leaflet-MiniMap : https://github.com/Norkart/Leaflet-MiniMap-->
	<script src="./lib/leaflet-plugin/MiniMap/Control.MiniMap.js" type="text/javascript"></script>
	<!--JS Leaflet.MousePosition : https://github.com/ardhi/Leaflet.MousePosition-->
	<script src="./lib/leaflet-plugin/MousePosition/L.Control.MousePosition.js" type="text/javascript"></script>
	<!--JS Leaflet.GeoSearch : https://github.com/smeijer/L.GeoSearch-->
	<script src="./lib/leaflet-plugin/GeoSearch/js/l.control.geosearch.js"></script>
	<script src="./lib/leaflet-plugin/GeoSearch/js/l.geosearch.provider.openstreetmap.js"></script>
	<!--JS Leaflet.MarkerCluster : https://github.com/Leaflet/Leaflet.markercluster -->
	<script src="./lib/leaflet-plugin/MarkerCluster/leaflet.markercluster-src.js"></script>
	<!--JS Leaflet.heat https://github.com/Leaflet/Leaflet.heat-->
	<script src="./lib/leaflet-plugin/Heat/dist/leaflet-heat.js"></script>
	<!--JS -->
<!--
	<script src="./lib/leaflet-plugin/GoogleMap/leaflet-google.js"></script>
-->

	<!--JS Proj4Leaflet https://github.com/kartena/Proj4Leaflet-->
<!--
	 <script src="./lib/leaflet-plugin/Proj4Leaflet/proj4-compressed.js"></script>
	<script src="./lib/leaflet-plugin/Proj4Leaflet/proj4leaflet.js"></script>
-->


	<!--<script src="script.js"></script>-->
	<div id="map"></div>
	<script type="text/javascript">

	//Déclaration des projections utilisées 
	//var epsg4326 = new Proj4js.Proj('EPSG:4326');
	//var epsg3857 = new Proj4js.Proj('EPSG:3857');
	//var epsg2154 = new Proj4js.Proj('EPSG:2154');

//var point = new L.Point(46.18390, -0.12640); // Lon/Lat
//var xy = new Proj4js.Point(lat_lng);
//Proj4js.transform(epsg900913,epsg2232,xy);


	// Définition CRS
	
	//Proj4js.defs["SR-ORG:6864"] = "+proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +a=6378137 +b=6378137 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs";
	//var crs = new L.Proj.CRS('EPSG:3006',
	//'+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs";
	//var crs = new L.Proj.CRS('EPSG:3006',
	//'+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs',
	//{
	//resolutions: [
	//8192, 4096, 2048, 1024, 512, 256, 128,
	//64, 32, 16, 8, 4, 2, 1, 0.5
	//],
	//origin: [0, 0]
	//}),
	//map = new L.Map('map', {
	//crs: crs,
	//continuousWorld: true,
	//worldCopyJump: false
	//});
	//
	//var source = new Proj4js.Proj('EPSG:3857');
	//var dest = new Proj4js.Proj('EPSG:4326');
	//46.18390, -0.12640
	//var p = new Proj4js.Point(-9096106.74,3679364.68); //this takes x,y
	//Proj4js.transform(source, dest, p);
	//this.map.setView(new L.LatLng(p.y, p.x),zoom);

	// IGN Géoportail Api Key
	//var ignApiKey = "" ;

	// IGN ORTHO
	//var orthoWmtsUrl	= "http://gpp3-wxs.ign.fr/"+ignApiKey + "/wmts?LAYER=ORTHOIMAGERY.ORTHOPHOTOS&EXCEPTIONS=text/xml&FORMAT=image/jpeg&SERVICE=WMTS&VERSION=1.0.0&REQUEST=GetTile&STYLE=normal&TILEMATRIXSET=PM&&TILEMATRIX={z}&TILECOL={x}&TILEROW={y}" ;
	//var ORTHO= L.tileLayer(orthoWmtsUrl, {attribution: '&copy; <a href="http://www.ign.fr/">IGN</a>'});

	// MapBox
	var mapbox   = L.tileLayer('https://b.tiles.mapbox.com/v3/examples.c7d2024a/{z}/{x}/{y}.png', {
	attribution: 'Map tiles by <a href="http://www.mapbox.com/">MapBox</a> &mdash; Map data &copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'});

	//Stamen
	var stamen = L.tileLayer('http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.png', {
	attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
	subdomains: 'abcd',	minZoom: 0,	maxZoom: 20	});

	//MapQuest
	var MapQuestOpen_OSM = L.tileLayer('http://otile{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.jpeg', {
	attribution: 'Tiles Courtesy of <a href="http://www.mapquest.com/">MapQuest</a> &mdash; Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
	subdomains: '1234'});

	//OSM
	var OpenStreetMap_Mapnik = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
	attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'});

	//
	//var googleLayer_Plan = new L.Google('ROADMAP');
	//var googleLayer_Satellite = new L.Google('SATELLITE');
	

	// On ajoute le fond de carte.
	//var caueUrl = 'http://{s}.livembtiles.makina-corpus.net/caue24/CAUE/{z}/{x}/{y}.png';
	//var caueAttrib = 'Données cartographiques fournies par le CAUE24';
	//var caueLayer = L.tileLayer(caueUrl, {
	//attribution: caueAttrib});

	var baseMap = {
		//"CAUE24" : caueLayer,
		//"Google Plan" : googleLayer_Plan,
		//"Google Satellite" : googleLayer_Satellite,
		"Mapbox": mapbox,
		"Mapnik": OpenStreetMap_Mapnik,
		"MapQuest": MapQuestOpen_OSM,
		"Stamen Toner": stamen
	};

	//----------------------------------------------------------------------------------------------------------------

	var myIcon = L.icon({
		iconUrl: 'http://www.igeo.fr/map-icons/pins/32/pin2.png',
		iconSize: [24, 24],
		iconAnchor: [12, 24]
	});

	//----------------------------------------------------------------------------------------------------------------
	
	coords = []; //define an array to store coordinates
	
	$.getJSON('data/20140702_exploitants.geojson', function(data) {
		var drone = L.geoJson(data, {
			onEachFeature: function (feature, layer) {
				layer.bindPopup('<b>'+feature.properties.NOM +'</b><br>'+ feature.properties.ADRESSE+'<br>'+ feature.properties.VILLE+'<br>'+ feature.properties.PAYS+'<br><a>Site web :</a> <a href=" ' + feature.properties.WEB + '">'+feature.properties.WEB +'</a><br><a style="color:red;"> Vérifié le : </a><a style="color:red;">'+feature.properties.VERIFICATION +'</a>');
				layer.setIcon (layer.options.icon =myIcon);
				coords.push(L.GeoJSON.coordsToLatLng(feature.geometry.coordinates));
			}
		});
	
	//----------------------------------------------------------------------------------------------------------------

	var markers = L.markerClusterGroup({
		spiderfyOnMaxZoom: false,
		showCoverageOnHover: true,
		zoomToBoundsOnClick: true,
		disableClusteringAtZoom: 13
	});
	markers.addLayer(drone);

//----------------------------------------------------------------------------------------------------------------

	var heat = L.heatLayer(
		coords,
		{
			maxZoom: 9,
			max:1, 
			radius: 15,
			blur: 15, 
			gradient: {
				0.0: "rgba(000,000,255,0)",
		        0.2: "rgba(000,000,255,1)",
		        0.4: "rgba(000,255,255,1)",
		        0.6: "rgba(000,255,000,1)",
		        0.8: "rgba(255,255,000,1)",
		        1.0: "rgba(255,000,000,1)"
	        }
		}
	);


//----------------------------------------------------------------------------------------------------------------

	var overlays = {
		"Exploitants en activités particulières<br>au moyen d'aéronefs télé-pilotés 02/07/2014 <br>-> <a href =http://www.developpement-durable.gouv.fr/Quelle-place-pour-les-drones-dans.html>Pour en savoir plus</a>": markers,
		"Heatmap des exploitants en activités <br>particulières au moyen d'aéronefs télé-pilotés<br><br>-> <a href =https://github.com/igeofr/igeofr.github.io/edit/master/map_drones/>Contribuer et maintenir le fichier</a> <br>-> <a href =https://twitter.com/iGeoFlo>Signaler une erreur</a>":heat 
	};

//----------------------------------------------------------------------------------------------------------------

	// Construct a bounding box for this map that the user cannot
	// move out of
	var southWest = L.latLng(39,-11),
	    northEast = L.latLng(53,12),
	    bounds = L.latLngBounds(southWest, northEast);
    
    
	var map = new L.Map('map',
		{
			center: [46.18390, -0.12640],
			//center: new L.Point(-0.12640, 46.18390),
			zoom: 8,
			//crs: L.CRS.EPSG3857,
			//crs: L.CRS.EPSG3857,
			maxBounds: bounds, 
			maxZoom: 12,
		    minZoom: 6,
			layers: [mapbox,markers]
		}
	);
	
	// Zoom sur l'étendu de la carte
	//map.fitBounds(bounds);

	L.control.layers(baseMap,overlays,{ collapsed: true }).addTo(map);
 


//----------------------------------------------------------------------------------------------------------------

		//Mini Map
		var mapbox2 = new L.TileLayer('https://b.tiles.mapbox.com/v3/examples.c7d2024a/{z}/{x}/{y}.png');
		var miniMap = new L.Control.MiniMap(mapbox2, { toggleDisplay: true}).addTo(map);

//----------------------------------------------------------------------------------------------------------------

		//Mouse Position
		L.control.mousePosition().addTo(map);

//----------------------------------------------------------------------------------------------------------------

		//Scale
		L.control.scale({ position: 'bottomleft'}).addTo(map);

//----------------------------------------------------------------------------------------------------------------

		// GeoRecherche
		new L.Control.GeoSearch({
		    provider: new L.GeoSearch.Provider.OpenStreetMap(),
		    position: 'topcenter',
		    showMarker: false
		}).addTo(map);
//----------------------------------------------------------------------------------------------------------------

});


	</script>
</body>
</html>
